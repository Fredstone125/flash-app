<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Flappy Bird Game</title>
  <link rel="manifest" href="manifest.json">
  <style>
    body, html {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: #87CEEB;
    }
    #gameCanvas {
      background-color: #70c5ce;
      display: block;
      border: 2px solid #000;
    }
  </style>
  <script>
    // Register the service worker for PWA functionality
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('./service-worker.js')
        .then(() => console.log('Service Worker Registered'))
        .catch(error => console.error('Service Worker Registration Failed:', error));
    }
  </script>
</head>
<body>
  <canvas id="gameCanvas" width="320" height="480"></canvas>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    // Game Variables
    let birdY = canvas.height / 2;
    let birdVelocity = 0;
    const gravity = 0.6;
    const flapStrength = -10;
    const birdSize = 20;
    let score = 0;
    let gameOver = false;

    // Column Variables
    const columnWidth = 50;
    const columnGap = 150;
    let columnX = canvas.width;
    let columnHeight = Math.floor(Math.random() * (canvas.height - columnGap));

    // Event Listener for Flap
    document.addEventListener("keydown", (e) => {
      if (e.code === "Space" && !gameOver) {
        birdVelocity = flapStrength;
      } else if (e.code === "Space" && gameOver) {
        resetGame();
      }
    });

    // Game Loop
    function gameLoop() {
      if (!gameOver) {
        // Clear Canvas
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // Draw Bird
        birdVelocity += gravity;
        birdY += birdVelocity;
        ctx.fillStyle = "yellow";
        ctx.fillRect(50, birdY, birdSize, birdSize);

        // Draw Column
        columnX -= 2; // Column speed
        if (columnX < -columnWidth) {
          columnX = canvas.width;
          columnHeight = Math.floor(Math.random() * (canvas.height - columnGap));
          score++;
        }
        ctx.fillStyle = "green";
        ctx.fillRect(columnX, 0, columnWidth, columnHeight); // Top column
        ctx.fillRect(columnX, columnHeight + columnGap, columnWidth, canvas.height); // Bottom column

        // Check for Collision
        if (birdY < 0 || birdY + birdSize > canvas.height ||
            (50 < columnX + columnWidth && 50 + birdSize > columnX &&
            (birdY < columnHeight || birdY + birdSize > columnHeight + columnGap))) {
          gameOver = true;
        }

        // Draw Score
        ctx.fillStyle = "white";
        ctx.font = "20px Arial";
        ctx.fillText("Score: " + score, 10, 25);

        // Loop the game
        requestAnimationFrame(gameLoop);
      } else {
        // Game Over Screen
        ctx.fillStyle = "black";
        ctx.font = "30px Arial";
        ctx.fillText("Game Over!", canvas.width / 2 - 70, canvas.height / 2 - 20);
        ctx.font = "20px Arial";
        ctx.fillText("Press Space to Restart", canvas.width / 2 - 90, canvas.height / 2 + 20);
      }
    }

    // Reset Game
    function resetGame() {
      birdY = canvas.height / 2;
      birdVelocity = 0;
      columnX = canvas.width;
      columnHeight = Math.floor(Math.random() * (canvas.height - columnGap));
      score = 0;
      gameOver = false;
      gameLoop();
    }

    // Start Game
    gameLoop();
  </script>
</body>
</html>
